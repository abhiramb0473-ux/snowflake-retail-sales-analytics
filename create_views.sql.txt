CREATE OR REPLACE VIEW SALES_VIEW AS
SELECT 
    O.ORDER_ID,
    C.CUSTOMER_NAME,
    C.REGION,
    P.CATEGORY,
    P.PRODUCT_NAME,
    O.QUANTITY,
    P.PRICE,
    O.QUANTITY * P.PRICE AS TOTAL_AMOUNT,
    O.ORDER_DATE
FROM ORDERS O
JOIN CUSTOMERS C ON O.CUSTOMER_ID = C.CUSTOMER_ID
JOIN PRODUCTS P ON O.PRODUCT_ID = P.PRODUCT_ID;

CREATE OR REPLACE VIEW SALES_BY_REGION AS
SELECT REGION, SUM(TOTAL_AMOUNT) AS TOTAL_SALES
FROM SALES_VIEW
GROUP BY REGION
ORDER BY TOTAL_SALES DESC;

CREATE OR REPLACE VIEW SALES_MONTHLY AS
SELECT DATE_TRUNC('month', ORDER_DATE) AS MONTH,
       SUM(TOTAL_AMOUNT) AS MONTHLY_SALES
FROM SALES_VIEW
GROUP BY 1
ORDER BY 1;

CREATE OR REPLACE VIEW TOP_CUSTOMERS AS
SELECT CUSTOMER_NAME,
       SUM(TOTAL_AMOUNT) AS TOTAL_SPENT
FROM SALES_VIEW
GROUP BY CUSTOMER_NAME
ORDER BY TOTAL_SPENT DESC;
